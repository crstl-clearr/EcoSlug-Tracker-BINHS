<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>EcoSlug Tracker - Application Log</title>
    <script>
        // Immediate theme initialization to prevent FOUC
        (function() {
            try {
                const theme = localStorage.getItem('theme') || 'system';
                const root = document.documentElement;
                
                // Remove any existing theme attributes first
                root.removeAttribute('data-theme');
                
                if (theme === 'light') {
                    root.setAttribute('data-theme', 'light');
                } else if (theme === 'dark') {
                    root.setAttribute('data-theme', 'dark');
                } else if (theme === 'system') {
                    // For system theme, check media query and set explicitly
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        root.setAttribute('data-theme', 'dark');
                    } else {
                        root.setAttribute('data-theme', 'light');
                    }
                }
            } catch (e) {
                // Fallback to light theme if localStorage fails
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="log-page">

    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Left Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="images/logo.svg" alt="EcoSlug Tracker Logo">
            </div>
            <div class="sidebar-title">EcoSlug Tracker</div>
            <div class="sidebar-subtitle">Pest Management</div>
        </div>

        <div class="sidebar-nav">
            <a href="log.html" class="sidebar-item active" onclick="setActiveNavItem(this)">
                <img src="images/log-icon.svg" alt="Log" class="sidebar-icon">
                <span class="sidebar-text">Application Log</span>
            </a>

            <a href="weather.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/weather-icon.svg" alt="Weather" class="sidebar-icon">
                <span class="sidebar-text">Weather Monitoring</span>
            </a>

            <a href="calculator.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/calculator-icon.svg" alt="Pest Reduction Calculator" class="sidebar-icon">
                <span class="sidebar-text">Pest Reduction Calculator</span>
            </a>

            <a href="pest-count.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/pest-icon.svg" alt="Pest Comparative Calculator" class="sidebar-icon">
                <span class="sidebar-text">Pest Comparative Calculator</span>
            </a>

            <hr style="margin: 1rem 1.5rem; border: none; border-top: 1px solid rgba(255,255,255,0.1);">

            <a href="settings.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/settings-icon.svg" alt="Settings" class="sidebar-icon">
                <span class="sidebar-text">Settings</span>
            </a>

            <a href="terms.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/terms-icon.svg" alt="Terms" class="sidebar-icon">
                <span class="sidebar-text">Terms & Conditions</span>
            </a>

            <a href="about.html" class="sidebar-item" onclick="setActiveNavItem(this)">
                <img src="images/about-icon.svg" alt="About" class="sidebar-icon">
                <span class="sidebar-text">About</span>
            </a>
        </div>
    </nav>

    <!-- Back Button (moved outside header for proper positioning) -->
    <button class="back-button" onclick="navigateHome()" title="Back to Home">
        <img src="images/back-icon.svg" alt="Back" style="width: 20px; height: 20px;">
    </button>

    <!-- Main Content Area -->
    <div class="main-layout" id="mainLayout">
        <div class="container">

        <header class="header">
            <!-- Mobile Menu Button -->
            <button class="menu-button" onclick="openSidebar()" title="Open Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="6" width="18" height="2" rx="1"></rect>
                    <rect x="3" y="11" width="18" height="2" rx="1"></rect>
                    <rect x="3" y="16" width="18" height="2" rx="1"></rect>
                </svg>
            </button>
            <div class="logo-container">
                <div class="logo-placeholder">
                    <img src="images/log-icon.svg" alt="Log" class="logo-icon" style="width: 60px; height: 60px;">
                </div>
            </div>
            <h1 class="app-title">Application Log</h1>
            <p class="app-subtitle">Track your pesticide applications</p>
        </header>

        <main class="log-container">

   <!-- Success/Error Messages -->
   <div id="messageContainer" style="display: none; text-align: center; margin: 1rem 0;"></div>

   <!-- Group Tabs -->
   <div class="group-tabs" style="display: flex; justify-content: center; margin-bottom: 1rem; gap: 0.5rem;">
     <button class="group-tab active" data-group="reduction" onclick="switchGroup('reduction')">Pest Reduction</button>
     <button class="group-tab" data-group="treated" onclick="switchGroup('treated')">Treated Group</button>
     <button class="group-tab" data-group="control" onclick="switchGroup('control')">Control Group</button>
   </div>

   <!-- Log Table -->
             <div class="log-table-container">
                <div class="log-header">
                    <h3>Application Records</h3>
                    <div class="log-stats">
                        <span id="totalEntries">0 entries</span>
                    </div>
                </div>

    <div class="table-wrapper">
  <table class="log-table" id="logTable">
    <thead>
      <tr>
        <th>Entry #</th>
        <th>Date Applied</th>
        <th>Time Applied</th>
        <th>Plant/Area Treated</th>
        <th>Type of Pesticide</th>
        <th>Dosage/Amount</th>
        <th>Notes/Remarks</th>
        <th class="actions-column" style="display: none;">Actions</th>
      </tr>
    </thead>
    <tbody id="logTableBody">

      <!-- Entries will be injected by log.js -->
    </tbody>
  </table>
</div>

    <!-- Empty State -->
    <div id="emptyState" class="empty-state" style="display: none;">
      <h3>No Applications Recorded</h3>
      <p>Start logging your pesticide applications to track effectiveness and compliance.</p>
      <button class="nav-button log-button" onclick="showEditModal()">
        <img src="images/log-icon.svg" alt="Add" class="button-icon">
        <span class="button-text">Add First Entry</span>
      </button>
    </div>
  </div>

  <!-- Export Button -->
  <div style="text-align: center; margin: 1.5rem 0;">
    <button class="nav-button export-button" onclick="exportLogData()">
      <span class="button-icon">ðŸ“¤</span>
      <span class="button-text">Export Log</span>
    </button>
  </div>

  <!-- Quick Actions -->
  <div class="weather-card quick-actions-card">
    <h3 style="text-align: center; margin-bottom: 1.5rem; color: #333;">Quick Actions</h3>
    <div class="button-group">
      <button class="nav-button weather-button" onclick="navigateToWeather()">
        <img src="images/weather-icon.svg" alt="Weather" class="button-icon">
        <span class="button-text">Check Weather</span>
      </button>
      <button class="nav-button calculator-button" onclick="window.location.href='calculator.html'">
        <img src="images/calculator-icon.svg" alt="Pest Reduction Calculator" class="button-icon">
        <span class="button-text">Pest Reduction Calculator</span>
      </button>
      <button class="nav-button pest-button" onclick="navigateToPestCount()">
        <img src="images/pest-icon.svg" alt="Pest Count" class="button-icon">
        <span class="button-text">Pest Comparative Calculator</span>
      </button>
    </div>
  </div>

           <!-- Edit Button (Bottom Right) -->
           <button id="editButton" class="edit-fab" onclick="toggleEditMode()" title="Edit Log">
               <img src="images/edit-icon.svg" alt="Edit" style="width: 24px; height: 24px; color: #fff">
           </button>

           <!-- Add Entry Button (shows in edit mode) -->
           <button id="addButton" class="add-fab" onclick="showEditModal()" title="Add Entry" style="display: none;">
               <span style="font-size: 24px; color: white;">+</span>
           </button>

            <!-- Exit Edit Mode Button -->
            <button id="exitEditButton" class="exit-fab" onclick="toggleEditMode()" title="Exit Edit Mode" style="display: none;">
               <img src="images/close-icon.svg" alt="Exit" style="width: 24px; height: 24px;">
            </button>

</main>

       </div>
   </div>
    <!-- Edit/Add Entry Modal -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Entry</h3>
                <button class="modal-close" onclick="hideEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="entryForm">
                    <input type="hidden" id="entryId" value="">

                    <div class="form-group">
                        <label for="group">Group:</label>
                        <select id="group" required>
                            <option value="reduction">Pest Reduction</option>
                            <option value="treated">Treated Group</option>
                            <option value="control">Control Group</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="dateApplied">Date Applied:</label>
                        <input type="date" id="dateApplied" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeApplied">Time Applied:</label>
                        <input type="time" id="timeApplied" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="plantArea">Plant/Area Treated:</label>
                        <input type="text" id="plantArea" placeholder="e.g., Garden bed A, Tomato plants" required style="color: black;">
                    </div>

                    <div class="form-group">
                        <label for="pesticideType">Type of Pesticide:</label>
                        <input type="text" id="pesticideType" placeholder="e.g., Insecticide, Fungicide, Herbicide" style="color: black;">
                    </div>

                    <div class="form-group">
                        <label for="dosageAmount">Dosage/Amount:</label>
                        <input type="text" id="dosageAmount" placeholder="e.g., 50ml per 1L water" required style="color: black;">
                    </div>

                    <div class="form-group">
                        <label for="notesRemarks">Notes/Remarks:</label>
                        <textarea id="notesRemarks" rows="3" placeholder="Additional notes, weather conditions, etc." style="color: black;"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="hideEditModal()">Cancel</button>
                <button type="button" class="btn-save" onclick="saveEntry()">Save Entry</button>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" style="display: none;" onclick="hideEditModal()"></div>

    <script src="js/theme.js"></script>
    <script src="js/main.js"></script>
    <script src="js/menu.js"></script>
    <script type="module" src="js/log.js"></script>

</body>
</html>
